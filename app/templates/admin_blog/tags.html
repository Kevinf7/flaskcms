{% extends "admin_main/base.html" %}
{% from 'macros/_modal.html' import modal %}
{% block title %}Blog{% endblock %}

{% block app_content %}
<div id="this-block">

  {{ modal('showDelModal', 'Confirm you wish to delete the tag "[[ tagName ]]"','Delete','doDelDelete','Cancel','doDelCancel') }}

  <div class="tabs is-boxed">
    <ul>
    <li :class="{ 'is-active': tabTagUsed }">
      <a href="#" @click.prevent="tabTagUsed=true">
      Tags used
      </a>
    </li>
    <li :class="{ 'is-active': !tabTagUsed }">
      <a href="#" @click.prevent="tabTagUsed=false">
      Tags not used
      </a>
    </li>
    </ul>
  </div>

  <div v-if="tabTagUsed">
    <table class="table is-striped is-hoverable">
    {% if tag_used|length > 0 %}
    <thead>
      <tr>
      <th>Name</th>
      <th>Posts used in</th>
      <th></th>
      </tr>
    </thead>
    {% endif %}
    <tbody>
    {% for tu in tag_used %}
      <tr>
      <td>{{ tu.name }}</td>
      <td>
        {% for p in tu.posts %}
        {% if not loop.last %}
        <a href="{{ url_for('admin_blog.edit_post',id=p.posts.id) }}">{{ p.posts.title }}</a>, 
        {% else %}
        <a href="{{ url_for('admin_blog.edit_post',id=p.posts.id) }}">{{ p.posts.title }}</a>
        {% endif %}
        {% endfor %}
      </td>
      <td>
        <a href="{{ url_for('admin_blog.tags',id=tu.id) }}">
        <i class="far fa-edit"></i></a>
      </td>
      </tr>
    {% endfor %}
    </tbody>
    </table>
  </div>

  <table v-else class="table is-striped is-hoverable">
    {% if tag_notused|length > 0 %}
    <thead>
    <tr>
      <th class="has-text-weight-bold">Name</th>
      <th class="has-text-weight-bold" colspan="2"></th>
    </tr>
    </thead>
    {% endif %}
    <tbody>
    {% for tnu in tag_notused %}
    <tr>
      <td>{{ tnu.name }}</td>
      <td>
        <a href="#" @click.prevent="showDel({{ tnu.id }}, '{{ tnu.name }}')">
          <i class="far fa-trash-alt"></i>
        </a>
      </td>
    </tr>
    {% endfor %}
    </tbody>
  </table>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  new Vue({
    el: '#this-block',
    delimiters: ['[[', ']]'],
    data: {
      tabTagUsed: true,
      id: 0,
      tagName: '',
      showDelModal: false
    },
    methods: {
      showDel(id, tagName) {
        this.id = id
        this.tagName = tagName
        this.showDelModal = true
      },
      doDelCancel() {
        this.showDelModal = false
      },
      doDelDelete() {
        this.showDelModal = false
      },
    }
  })
</script>
{% endblock %}
